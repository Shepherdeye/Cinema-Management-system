@model MovieWithData
@{
    var statuses = new List<StatusOption>
    {
        new StatusOption { Id = MovieStatus.Available, Name = "Available" },
        new StatusOption { Id = MovieStatus.Expired, Name = "Expired" },
        new StatusOption { Id = MovieStatus.Upcoming, Name = "Upcoming" }
    };
}

<div class="container mt-5">
    <div class="card shadow-lg p-4">
        <h3 class="text-center mb-4">Edit Movie</h3>

        <form method="post" enctype="multipart/form-data">


            <!-- Movie Name -->
            <div class="mb-3">
                <label for="Name" class="form-label">Movie Name</label>
                <input type="text" class="form-control" value="@Model.Movie.Name" id="Name" name="Name" placeholder="Enter movie name" required>
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label for="Description" class="form-label">Description</label>
                <textarea class="form-control" id="Description" name="Description" rows="4" placeholder="Enter description">@Model.Movie.Description</textarea>
            </div>

            <!-- Price -->
            <div class="mb-3">
                <label for="Price" class="form-label">Price</label>
                <input type="number" value="@Model.Movie.Price" step="0.01" class="form-control" id="Price" name="Price" placeholder="Enter price" required>
            </div>

            <!-- Poster Upload -->
            <div class="mb-3">
                <label for="ImgUrl" class="form-label">Movie Poster</label>
                <input type="file" class="form-control" id="ImgUrl" name="ImgUrl" accept="image/*" onchange="previewPoster(event)">
            </div>

            <!-- Current Poster Preview -->
            <div class="mb-3">
                <img id="posterPreview"
                     src="~/visitor/assets/@Model.Movie.ImgUrl"
                     alt="Current Poster"
                     class="img-thumbnail"
                     style="max-width: 200px; @(string.IsNullOrEmpty(Model.Movie.ImgUrl) ? "display:none;" : "")">
            </div>

            <!-- Trailer URL -->
            <div class="mb-3">
                <label for="TrailerUrl" class="form-label">Trailer URL</label>
                <input type="url" class="form-control" value="@Model.Movie.TrailerUrl" id="TrailerUrl" name="TrailerUrl" placeholder="https://youtube.com/...">
            </div>

            <!-- Start Date -->
            <div class="mb-3">
                <label for="StartDate" class="form-label">Start Date</label>
                <input value="@Model.Movie.StartDate.ToString("yyyy-MM-ddTHH:mm")" type="datetime-local" class="form-control" id="StartDate" name="StartDate" required>
            </div>

            <!-- End Date -->
            <div class="mb-3">
                <label for="EndDate" class="form-label">End Date</label>
                <input value="@Model.Movie.EndDate.ToString("yyyy-MM-ddTHH:mm")" type="datetime-local" class="form-control" id="EndDate" name="EndDate" required>
            </div>

            <!-- Movie Status -->
            <div class="mb-3">
                <label for="MovieStatus" class="form-label">Movie Status</label>
                <select class="form-control" id="MovieStatus" name="MovieStatus">
                    @foreach (var status in statuses)
                    {
                        if (status.Id == Model.Movie.MovieStatus)
                        {
                            <option selected value="@status.Id">@status.Name</option>
                        }
                        else
                        {
                            <option value="@status.Id">@status.Name</option>
                        }

                    }
                </select>
            </div>

            <!-- Cinema Dropdown -->
            <div class="mb-3">
                <label for="CinemaId" class="form-label">Cinema</label>
                <select class="form-control" id="CinemaId" name="CinemaId" required>
                    <option value="">-- Select Cinema --</option>
                    @foreach (var cinema in Model.Cinemas)
                    {
                        if (Model.Movie.CinemaId == cinema.Id)
                        {
                            <option selected value="@cinema.Id">@cinema.Name</option>
                        }
                        else
                        {
                            <option value="@cinema.Id">@cinema.Name</option>
                            
                        }
                    }
                </select>
            </div>

            <!-- Category Dropdown -->
            <div class="mb-3">
                <label for="CategoryId" class="form-label">Category</label>
                <select class="form-control" id="CategoryId" name="CategoryId" required>
                    <option value="">-- Select Category --</option>
                    @foreach (var category in Model.Categories)
                    {
                            if (Model.Movie.CategoryId == category.Id)
                        {
                            <option selected value="@category.Id">@category.Name</option>
                        }
                        else
                        {
                             <option value="@category.Id">@category.Name</option>
                            
                        }
                      
                    }
                </select>
            </div>

            <!-- Buttons -->
            <div class="text-center">
                <button type="submit" class="btn btn-success px-4">Save Movie</button>
                <a href="/admin/movie" class="btn btn-secondary px-4 ms-2">Cancel</a>
            </div>
        </form>
    </div>
</div>


<script>
    function previewPoster(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('posterPreview');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        } else {
            // Keep the original image if no new file is selected
            preview.src = "@Model.Movie?.ImgUrl";
            preview.style.display = '@(string.IsNullOrEmpty(Model.Movie?.ImgUrl) ? "none" : "block")';
        }
    }
</script>