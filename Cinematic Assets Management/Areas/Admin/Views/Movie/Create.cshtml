@model MovieWithData 

@section Scripts {
    <partial name="_PartialNotification"></partial>
    <partial name="_ValidationScriptsPartial"></partial>
    
}

<style>
    .photo-card {
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .photo-card img {
            transition: transform 0.4s ease;
            display: block;
            width: 100%;
            height: auto;
        }

        .photo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }

            .photo-card:hover img {
                transform: scale(1.08);
            }
</style>
<div class="container mt-5">
    <div class="card shadow-lg p-4">
        <h3 class="text-center mb-4">Add Movie</h3>

        <form method="post" enctype="multipart/form-data">
           
            
            <!-- Movie Name -->
            <div class="mb-3">
                <label for="Name" class="form-label">Movie Name</label>
                <input type="text"  value="@Model.Movie.Name" class="form-control" id="Name" name="Name" placeholder="Enter movie name" >
              <span class="alert-danger" asp-validation-for="Movie.Name"></span> 
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label for="Description" class="form-label">Description</label>
                <textarea class="form-control" id="Description" name="Description" rows="4" placeholder="Enter description">@Model.Movie.Description</textarea>
            </div>

            <!-- Price -->
            <div class="mb-3">
                <label for="Price" class="form-label">Price</label>
                <input type="number" step="0.01" value="@Model.Movie.Price" class="form-control" id="Price" name="Price" placeholder="Enter price" >
            </div>

            <!-- Poster Upload -->
            <div class="mb-3">
                <label for="ImgUrl" class="form-label">Movie Poster</label>
                <input type="file" class="form-control" id="ImgUrl" name="ImgUrl" accept="image/*" onchange="previewPoster(event)">
            </div>
            <!-- Preview Image -->
            <div class="mb-3">
                <img id="posterPreview" src="~/visitor/assets/@Model.Movie.ImgUrl" alt="Poster Preview" class="img-thumbnail" style="max-width: 200px; display: none;">
            </div>
            <!-- Movie Images-->
            <div class="mb-3">
                <label for="Images" class="form-label">Movie Images</label>
                <input type="file"  class="form-control" id="Images" name="Images" accept="image/*" multiple >
            </div>
            <!-- preview-->
            <div id="imagePreview" class="row g-3"></div>
            <!-- Trailer URL -->
            <div class="mb-3">
                <label for="TrailerUrl"  class="form-label">Trailer URL</label>
                <input type="url" class="form-control" value="@Model.Movie.TrailerUrl" id="TrailerUrl" name="TrailerUrl" placeholder="https://youtube.com/...">
            </div>

            <!-- Start Date -->
            <div class="mb-3">
                <label for="StartDate" class="form-label">Start Date</label>
                <input type="datetime-local" class="form-control" value="@Model.Movie.StartDate.ToString("yyyy-MM-ddTHH:mm")" id="StartDate" name="StartDate" required>
            </div>

            <!-- End Date -->
            <div class="mb-3">
                <label for="EndDate" class="form-label">End Date</label>
                <input type="datetime-local" class="form-control" value="@Model.Movie.StartDate.ToString("yyyy-MM-ddTHH:mm")" id="EndDate" name="EndDate" required>
            </div>

            <!-- Movie Status -->
            <div class="mb-3">
                <label for="MovieStatus" class="form-label">Movie Status</label>
                <select class="form-control" id="MovieStatus" name="MovieStatus">

                    @foreach (MovieStatus item in Enum.GetValues(typeof(MovieStatus)))
                    {

                        if (Model.Movie.MovieStatus==item)
                        {
                            <option selected value="@item">@item.ToString()</option>
                        }
                        else
                        {
                            <option value="@item">@item.ToString()</option>
                        }

                    }
                </select>
            </div>

            <!-- Cinema Dropdown -->
            <div class="mb-3">
                <label for="CinemaId" class="form-label">Cinema</label>
                <select class="form-control" id="CinemaId" name="CinemaId" required>
                    <option value="">-- Select Cinema --</option>
                    @foreach (var cinema in Model.Cinemas)
                    {
                        if (cinema.Id == Model.Movie.CinemaId)
                        {
                            <option selected value="@cinema.Id">@cinema.Name</option>
                        }
                        else
                        {
                            
                            <option value="@cinema.Id">@cinema.Name</option>
                        }
                    }
                </select>
            </div>

            <!-- Category Dropdown -->
            <div class="mb-3">
                <label for="CategoryId" class="form-label">Category</label>
                <select class="form-control" id="CategoryId" name="CategoryId" required>
                    <option value="">-- Select Category --</option>
                    @foreach (var category in Model.Categories)
                    {
                        if (category.Id == Model.Movie.CategoryId)
                        {
                            <option selected value="@category.Id">@category.Name</option>

                        }
                        else
                        {
                             <option value="@category.Id">@category.Name</option>

                        }
                    }
                </select>
            </div>
            <!-- Actors Dropdown -->
            <div class="mb-3">
                <label for="ActorId" class="form-label">Select Actors</label>
                <select multiple class="form-control" id="ActorId" name="Actors">
                    <option value="">-- Select Actors--</option>
                    @foreach (var actor in Model.Actors)
                    {
                     
                    <option selected value="@actor.Id">@actor.FirstName @actor.LastName</option>

                     }
                </select>
            </div>

            <!-- Buttons -->
            <div class="text-center">
                <button type="submit" class="btn btn-success px-4">Save Movie</button>
                <a href="/admin/movie" class="btn btn-secondary px-4 ms-2">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    function previewPoster(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('posterPreview');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        } else {
            preview.src = "#";
            preview.style.display = 'none';
        }
    }

</script>


<script>
    document.getElementById('Images').addEventListener('change', function (event) {
        let preview = document.getElementById('imagePreview');
        preview.innerHTML = ''; // Clear previous images

        Array.from(event.target.files).forEach(file => {
            if (file.type.startsWith('image/')) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    let col = document.createElement('div');
                    col.classList.add('col-6', 'col-md-3');
                    col.innerHTML = `
                        <div class="photo-card">
                            <img src="${e.target.result}" class="img-fluid rounded" alt="Preview">
                        </div>
                    `;
                    preview.appendChild(col);
                }
                reader.readAsDataURL(file);
            }
        });
    });
</script>


